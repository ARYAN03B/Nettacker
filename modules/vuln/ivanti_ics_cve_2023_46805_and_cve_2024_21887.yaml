info:
  name: ivanti_ics_cve_2023_46805_and_cve_2024_21887_vuln
  author: Jimmy Ly
  severity: 9.1
  description: Ivanti Connect Secure Unauthenticated Remote Code Execution. CVE-2023-46805 is an authentication bypass and CVE-2024-21887 is a command injection vulnerability in the web component of Ivanti ICS 9.x, 22.x. These two vulnerabilites can be chained to allow remote code exeuction as an unauthenticated user.
  reference: 
    - https://forums.ivanti.com/s/article/CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways?language=en_US
    - https://labs.watchtowr.com/welcome-to-2024-the-sslvpn-chaos-continues-ivanti-cve-2023-46805-cve-2024-21887
  profiles:
    - vuln
    - vulnerability
    - http
    - critical_severity
    - cve
    - ivanti
    - ivanti_connect_secure
    - invati_ics

payloads:
  - library: http
    steps:
      - method: get
        timeout: 3
        headers:
          User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.5615.138 Safari/537.36"
        allow_redirects: false
        ssl: false
        url:
          nettacker_fuzzer:
            input_format: "{{schema}}://{target}:{{ports}}/{{paths}}"
            prefix: ""
            suffix: ""
            interceptors:
            data:
              paths:  
                - "api/v1/configuration/users/user-roles/user-role/rest-userrole1/web/web-bookmarks/bookmark"
              schema:
                - "http"
                - "https"
              ports:
                - 80
                - 443
        response:
          condition_type: and
          conditions:
            status_code:
              regex: '403'
              reverse: false
            content:
              regex: '<html>'
              reverse: true